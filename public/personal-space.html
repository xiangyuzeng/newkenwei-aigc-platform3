<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼“å­˜ç®¡ç†</title>
    <link rel="stylesheet" href="styles/workspace.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; background: #f5f7fa; min-height: 100vh; color: #1e293b; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .top-header { background: #fff; padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; left: 0; right: 0; z-index: 100; height: 56px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .header-btn { display: flex; align-items: center; gap: 6px; padding: 8px 16px; background: #f8f9fb; border: 1px solid #e8ecf1; border-radius: 8px; font-size: 13px; color: #475569; cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .header-btn:hover { background: #f0f2f5; border-color: #d1d5db; }
        .page-title { font-size: 20px; font-weight: 600; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .header-right { display: flex; align-items: center; gap: 12px; }
        .header-icon-btn { width: 36px; height: 36px; border-radius: 8px; border: 1px solid #e8ecf1; background: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; color: #64748b; }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content { margin-top: 72px; padding: 24px; max-width: 1200px; margin-left: auto; margin-right: auto; }
        
        /* å…¬å‘Š */
        .announcement { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #f59e0b; border-radius: 12px; padding: 16px 20px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 12px; }
        .announcement-icon { font-size: 24px; flex-shrink: 0; }
        .announcement-content { flex: 1; }
        .announcement-title { font-size: 14px; font-weight: 600; color: #92400e; margin-bottom: 6px; }
        .announcement-text { font-size: 13px; color: #92400e; line-height: 1.8; }
        .announcement-text strong { color: #dc2626; font-weight: 700; }
        .announcement-close { background: none; border: none; font-size: 18px; color: #a16207; cursor: pointer; padding: 0; line-height: 1; }
        .announcement-close:hover { color: #92400e; }
        
        /* é¢æ¿ */
        .panel-section { background: #fff; border-radius: 12px; padding: 20px; border: 1px solid #e8ecf1; margin-bottom: 20px; }
        .section-title { font-size: 15px; font-weight: 600; color: #1e293b; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .section-desc { font-size: 13px; color: #94a3b8; margin-bottom: 20px; line-height: 1.6; }
        
        /* APIKeyç®¡ç† */
        .apikey-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .apikey-card { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; }
        .apikey-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
        .apikey-card-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #fff; }
        .apikey-card-icon.gemini { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .apikey-card-title { font-size: 14px; font-weight: 600; color: #1e293b; }
        .apikey-card-subtitle { font-size: 11px; color: #94a3b8; }
        .apikey-input-group { margin-bottom: 12px; }
        .apikey-input-label { font-size: 12px; color: #64748b; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
        .apikey-input-label .badge { padding: 2px 6px; background: #dbeafe; color: #2563eb; border-radius: 4px; font-size: 10px; font-weight: 600; }
        .apikey-input-label .badge.backup { background: #fef3c7; color: #d97706; }
        .apikey-input { width: 100%; padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px; font-family: monospace; transition: all 0.2s; }
        .apikey-input:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .apikey-input.has-value { border-color: #10b981; background: #f0fdf4; }
        .apikey-actions { display: flex; gap: 8px; margin-top: 16px; }
        .apikey-save-btn { flex: 1; padding: 10px 16px; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); color: #fff; border: none; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .apikey-save-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .apikey-clear-btn { padding: 10px 16px; background: #fee2e2; color: #ef4444; border: none; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .apikey-clear-btn:hover { background: #fecaca; }
        .apikey-status { margin-top: 12px; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: none; }
        .apikey-status.success { display: block; background: #d1fae5; color: #065f46; }
        .apikey-status.empty { display: block; background: #fef3c7; color: #92400e; }
        
        /* æœç´¢åŒºåŸŸ */
        .search-row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 16px; }
        .search-input { flex: 1; min-width: 200px; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; transition: all 0.2s; }
        .search-input:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .search-btn { padding: 12px 24px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: #fff; border: none; border-radius: 10px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .search-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .clear-btn { padding: 12px 24px; background: #ef4444; color: #fff; border: none; border-radius: 10px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .clear-btn:hover { background: #dc2626; }
        
        /* ç»Ÿè®¡ */
        .stats-row { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
        .stat-item { background: #f8fafc; padding: 12px 20px; border-radius: 10px; font-size: 13px; color: #64748b; }
        .stat-item strong { color: #6366f1; font-size: 16px; }
        
        /* è¿‡æ»¤ */
        .filter-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; background: #f1f5f9; border: none; border-radius: 8px; font-size: 13px; color: #64748b; cursor: pointer; transition: all 0.2s; }
        .filter-btn:hover { background: #e2e8f0; }
        .filter-btn.active { background: #6366f1; color: #fff; }
        
        /* ç»“æœç½‘æ ¼ */
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .results-count { font-size: 13px; color: #94a3b8; }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .result-card { background: #f8fafc; border-radius: 12px; overflow: hidden; transition: all 0.2s; border: 1px solid #e2e8f0; cursor: pointer; }
        .result-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
        .result-preview { width: 100%; aspect-ratio: 1; background: #e2e8f0; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        .result-preview img { width: 100%; height: 100%; object-fit: cover; }
        .result-preview video { width: 100%; height: 100%; object-fit: cover; }
        .result-type-badge { position: absolute; top: 8px; left: 8px; padding: 4px 10px; background: rgba(0,0,0,0.6); color: #fff; font-size: 11px; border-radius: 6px; }
        .result-info { padding: 16px; }
        .result-title { font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .result-meta { font-size: 12px; color: #94a3b8; margin-bottom: 12px; }
        .result-meta span { display: block; margin-bottom: 4px; }
        .result-actions { display: flex; gap: 8px; }
        .result-actions button { flex: 1; padding: 8px; border: none; border-radius: 8px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .btn-download { background: #6366f1; color: #fff; }
        .btn-download:hover { background: #4f46e5; }
        .btn-delete { background: #fee2e2; color: #ef4444; }
        .btn-delete:hover { background: #fecaca; }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state { text-align: center; padding: 60px 20px; color: #94a3b8; }
        .empty-state .icon { font-size: 64px; margin-bottom: 16px; }
        .empty-state h3 { font-size: 18px; color: #64748b; margin-bottom: 12px; }
        .empty-state p { font-size: 13px; line-height: 1.8; max-width: 450px; margin: 0 auto; }
        .empty-state strong { color: #dc2626; font-weight: 700; }
        
        /* æç¤º */
        .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); padding: 12px 24px; background: #1e293b; color: #fff; border-radius: 10px; font-size: 14px; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
        .toast.show { opacity: 1; }
        
        /* é¢„è§ˆå¼¹çª— */
        .preview-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .preview-modal.show { display: flex; }
        .preview-close { position: absolute; top: 20px; right: 20px; width: 44px; height: 44px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; color: #fff; font-size: 24px; cursor: pointer; transition: all 0.2s; z-index: 10; }
        .preview-close:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .preview-content { max-width: 90vw; max-height: 80vh; display: flex; align-items: center; justify-content: center; }
        .preview-content img { max-width: 100%; max-height: 80vh; object-fit: contain; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .preview-content video { max-width: 100%; max-height: 80vh; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .preview-info { margin-top: 16px; text-align: center; color: #fff; max-width: 600px; }
        .preview-info .source { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .preview-info .prompt { font-size: 13px; color: rgba(255,255,255,0.7); line-height: 1.6; word-break: break-all; }
        .preview-info .time { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 8px; }
        .preview-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; color: #fff; font-size: 24px; cursor: pointer; transition: all 0.2s; }
        .preview-nav:hover { background: rgba(255,255,255,0.2); }
        .preview-nav.prev { left: 20px; }
        .preview-nav.next { right: 20px; }
        .preview-nav:disabled { opacity: 0.3; cursor: not-allowed; }
        .preview-actions { margin-top: 16px; display: flex; gap: 12px; }
        .preview-actions button { padding: 10px 24px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; transition: all 0.2s; }
        .preview-actions .btn-download { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: #fff; }
        .preview-actions .btn-download:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4); }
        
        @media (max-width: 768px) {
            .search-row { flex-direction: column; }
            .search-input { width: 100%; }
            .results-grid { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 480px) {
            .results-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="top-header">
        <div class="header-left">
        </div>
        <span class="page-title">ç¼“å­˜ç®¡ç†</span>
        <div class="header-right">
            <button class="header-icon-btn">ğŸ””</button>
        </div>
    </header>
    
    <main class="main-content">
        <div class="announcement" id="announcement">
            <span class="announcement-icon">âš ï¸</span>
            <div class="announcement-content">
                <div class="announcement-title">ç¼“å­˜ç®¡ç†è¯´æ˜</div>
                <div class="announcement-text">
                    æ­¤é¡µé¢å±•ç¤ºæ‰€æœ‰ç”Ÿæˆçš„å›¾ç‰‡å’Œè§†é¢‘ç¼“å­˜ã€‚ç¼“å­˜åŸºäº<strong>æµè§ˆå™¨æœ¬åœ°å­˜å‚¨</strong>ï¼Œå…³é—­æµè§ˆå™¨ä¾ç„¶å­˜åœ¨ï¼Œä½†<strong>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åæ•°æ®å°†å…¨éƒ¨æ¸…é›¶</strong>ã€‚<br>
                    <strong style="color: #dc2626;">âš ï¸ é‡è¦ï¼š</strong>åˆ é™¤ç¼“å­˜åï¼Œè¯·<strong>åˆ·æ–°å…¶ä»–å·²æ‰“å¼€çš„é¡µé¢</strong>ï¼ˆæŒ‰ F5 æˆ– Ctrl+Rï¼‰ä»¥æŸ¥çœ‹æ›´æ–°ã€‚
                </div>
            </div>
            <button class="announcement-close" onclick="document.getElementById('announcement').style.display='none'">âœ•</button>
        </div>
        
        <!-- ç”¨æˆ·çŠ¶æ€ -->
        <section class="panel-section" id="userStatusSection">
            <div id="userStatusContainer" style="display: flex; align-items: center; gap: 16px;">
                <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
            </div>
        </section>
        
        <!-- æ“ä½œæ  -->
        <section class="panel-section">
            <div class="search-row">
                <button class="search-btn" id="refreshBtn">ğŸ”„ åˆ·æ–°</button>
                <button class="search-btn" id="downloadAllBtn" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">ğŸ“¥ å…¨éƒ¨ä¸‹è½½</button>
                <button class="clear-btn" id="deleteAllBtn">ğŸ—‘ï¸ å…¨éƒ¨åˆ é™¤</button>
            </div>
            <div class="stats-row" id="statsRow">
                <div class="stat-item">å›¾ç‰‡: <strong id="imageCount">0</strong></div>
                <div class="stat-item">è§†é¢‘: <strong id="videoCount">0</strong></div>
                <div class="stat-item">å­˜å‚¨å ç”¨: <strong id="storageSize">0 MB</strong></div>
            </div>
            <div class="filter-row">
                <button class="filter-btn active" data-type="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-type="image">å›¾ç‰‡</button>
                <button class="filter-btn" data-type="video">è§†é¢‘</button>
            </div>
        </section>
        
        <!-- åª’ä½“ç½‘æ ¼ -->
        <section class="panel-section">
            <div class="results-header">
                <h2 class="section-title">ğŸ“‹ ç¼“å­˜åˆ—è¡¨</h2>
                <span class="results-count" id="resultsCount">å…± 0 é¡¹</span>
            </div>
            <div class="results-grid" id="resultsGrid">
                <div class="empty-state">
                    <div class="icon">ğŸ“­</div>
                    <h3>æš‚æ— ç¼“å­˜</h3>
                    <p>ä½¿ç”¨å„åŠŸèƒ½ç”Ÿæˆå›¾ç‰‡æˆ–è§†é¢‘åï¼Œä¼šè‡ªåŠ¨ä¿å­˜åˆ°è¿™é‡Œã€‚</p>
                </div>
            </div>
        </section>
    </main>
    
    <div class="toast" id="toast"></div>
    
    <!-- é¢„è§ˆå¼¹çª— -->
    <div class="preview-modal" id="previewModal">
        <button class="preview-close" onclick="closePreview()">âœ•</button>
        <button class="preview-nav prev" id="prevBtn" onclick="navigatePreview(-1)">â€¹</button>
        <button class="preview-nav next" id="nextBtn" onclick="navigatePreview(1)">â€º</button>
        <div class="preview-content" id="previewContent"></div>
        <div class="preview-info" id="previewInfo"></div>
        <div class="preview-actions">
            <button class="btn-download" id="previewDownloadBtn">ğŸ“¥ ä¸‹è½½</button>
        </div>
    </div>

    <script src="scripts/duu-db.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/image-server.js"></script>
    <script src="scripts/apikeys.js"></script>
    <!-- JSZip ç”¨äºæ‰¹é‡ä¸‹è½½æ‰“åŒ… -->
    <script src="vendor/jszip.min.js"></script>
    <script>
        let allMediaItems = []; // æ‰€æœ‰å›¾ç‰‡å’Œè§†é¢‘ï¼ˆæœ¬åœ°ï¼‰
        let cloudMediaItems = []; // äº‘ç«¯æ•°æ®
        let currentFilter = 'all';
        let currentPage = 1;
        let totalPages = 1;
        let isLoggedIn = false; // æ˜¯å¦ç™»å½•ç”¨æˆ·
        let currentPreviewIndex = -1; // å½“å‰é¢„è§ˆçš„ç´¢å¼•
        let currentPreviewList = []; // å½“å‰é¢„è§ˆçš„åˆ—è¡¨
        
        const showToast = (msg) => {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        };
        
        const formatTime = (timestamp) => {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor(diff / (1000 * 60));
            
            if (minutes < 1) return 'åˆšåˆš';
            if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
            if (hours < 24) return `${hours}å°æ—¶å‰`;
            return date.toLocaleString('zh-CN');
        };
        
        // æ¸²æŸ“ç”¨æˆ·çŠ¶æ€
        const renderUserStatus = () => {
            const container = document.getElementById('userStatusContainer');
            if (!container) return;
            
            if (typeof DuuAuth !== 'undefined' && DuuAuth.isLoggedIn()) {
                isLoggedIn = true;
                const user = DuuAuth.getUser();
                container.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 18px;">ğŸ‘¤</div>
                        <div>
                            <div style="font-size: 15px; font-weight: 600; color: #1e293b;">${user.username}</div>
                            <div style="font-size: 12px; color: #10b981;">â˜ï¸ äº‘ç«¯åŒæ­¥å·²å¼€å¯</div>
                        </div>
                    </div>
                    <button onclick="DuuAuth.logout()" style="padding: 8px 16px; background: #fee2e2; color: #dc2626; border: none; border-radius: 8px; font-size: 13px; cursor: pointer;">é€€å‡ºç™»å½•</button>
                `;
            } else {
                isLoggedIn = false;
                container.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #94a3b8 0%, #cbd5e1 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 18px;">ğŸ§©</div>
                        <div>
                            <div style="font-size: 15px; font-weight: 600; color: #64748b;">æœ¬åœ°æ¨¡å¼</div>
                            <div style="font-size: 12px; color: #f59e0b;">ğŸ’¾ æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°</div>
                        </div>
                    </div>
                `;
            }
        };
        
        // ä»æœåŠ¡å™¨åŠ è½½äº‘ç«¯æ•°æ®
        const loadCloudData = async (page = 1) => {
            // å¿…é¡»ç™»å½•æ‰èƒ½åŠ è½½äº‘ç«¯æ•°æ®
            if (!isLoggedIn) {
                showToast('è¯·å…ˆç™»å½•è´¦å·');
                return [];
            }
            
            try {
                console.log('æ­£åœ¨åŠ è½½äº‘ç«¯æ•°æ®...');
                const data = await ImageServer.getGenerations('', page, 50);
                console.log('äº‘ç«¯æ•°æ®è¿”å›:', data);
                
                totalPages = data.totalPages || 1;
                currentPage = data.page || 1;
                
                const items = [];
                if (data.generations && Array.isArray(data.generations)) {
                    data.generations.forEach(gen => {
                        if (gen.images && Array.isArray(gen.images)) {
                            gen.images.forEach((img, idx) => {
                                items.push({
                                    id: `cloud-${gen.id}-${idx}`,
                                    generationId: gen.id,
                                    type: 'image',
                                    data: img.url,
                                    source: gen.model || 'äº‘ç«¯',
                                    prompt: gen.prompt || 'æ— æç¤ºè¯',
                                    timestamp: new Date(gen.created_at).getTime(),
                                    fromCloud: true
                                });
                            });
                        }
                    });
                }
                
                console.log('è§£æåäº‘ç«¯æ•°æ®é¡¹æ•°:', items.length);
                
                if (items.length === 0) {
                    showToast('äº‘ç«¯æš‚æ— æ•°æ®');
                }
                
                return items;
            } catch (error) {
                console.error('åŠ è½½äº‘ç«¯æ•°æ®å¤±è´¥:', error);
                showToast('åŠ è½½äº‘ç«¯æ•°æ®å¤±è´¥: ' + error.message);
                return [];
            }
        };
        
        // åˆ é™¤äº‘ç«¯è®°å½•
        window.deleteCloudMedia = async (generationId) => {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡äº‘ç«¯è®°å½•å—ï¼Ÿ')) return;
            
            if (!isLoggedIn) {
                showToast('è¯·å…ˆç™»å½•è´¦å·');
                return;
            }
            
            try {
                await ImageServer.deleteGeneration('', generationId);
                showToast('åˆ é™¤æˆåŠŸ');
                // é‡æ–°åŠ è½½äº‘ç«¯æ•°æ®
                cloudMediaItems = await loadCloudData(currentPage);
                renderMedia(cloudMediaItems);
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                showToast('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        };
        
        // ä»æ•°æ®åº“ä¸­æå–æ‰€æœ‰å›¾ç‰‡å’Œè§†é¢‘
        const extractAllMedia = async () => {
            await DuuDB.init();
            const mediaItems = [];
            const seenIds = new Set(); // ç”¨äºå»é‡
            
            // ä»ä¸ªäººç©ºé—´è·å–
            try {
                const personalRecords = await DuuDB.getPersonalRecords();
                personalRecords.forEach(record => {
                    const uniqueId = `personal-${record.id}`;
                    if (!seenIds.has(uniqueId)) {
                        seenIds.add(uniqueId);
                        mediaItems.push({
                            id: uniqueId,
                            dbId: record.id,
                            type: record.type,
                            data: record.data,
                            source: record.source,
                            prompt: record.title,
                            timestamp: record.createdAt,
                            fromPersonal: true
                        });
                    }
                });
            } catch (e) {
                console.warn('è¯»å–ä¸ªäººç©ºé—´å¤±è´¥:', e);
            }
            
            // ä»ä»»åŠ¡å†å²è·å–
            const pageKeys = [
                'gemini-extract', 'gemini-custom', 'gemini-four-ref', 'gemini-ten-ref',
                'gemini-cpsj', 'kling-image2video', 'kling-text2video'
            ];
            const namespaceMap = {
                'gemini-extract': 'æå–å°èŠ±',
                'gemini-four-ref': 'å››å›¾å‚è€ƒ',
                'gemini-ten-ref': 'åå›¾å‚è€ƒ',
                'gemini-custom': 'è‡ªå®šä¹‰',
                'gemini-cpsj': 'äº§å“æµ·æŠ¥',
                'kling-image2video': 'å¯çµå›¾ç”Ÿè§†é¢‘',
                'kling-text2video': 'å¯çµæ–‡ç”Ÿè§†é¢‘'
            };
            
            for (const pageKey of pageKeys) {
                try {
                    const tasks = await DuuDB.getTasks(pageKey);
                    const sourceName = namespaceMap[pageKey] || pageKey;
                    
                    tasks.forEach((task, taskIndex) => {
                        // å¤„ç†å›¾ç‰‡ä»»åŠ¡
                        if (task.images && Array.isArray(task.images)) {
                            task.images.forEach((image, imageIndex) => {
                                const imageData = image.url || (image.data ? `data:${image.mimeType || 'image/png'};base64,${image.data}` : null);
                                if (imageData) {
                                    const uniqueId = `history-${task.id}-${imageIndex}`;
                                    if (!seenIds.has(uniqueId)) {
                                        seenIds.add(uniqueId);
                                        mediaItems.push({
                                            id: uniqueId,
                                            taskId: task.id,
                                            imageIndex: imageIndex, // ä¿å­˜å›¾ç‰‡ç´¢å¼•ç”¨äºåˆ é™¤
                                            type: 'image',
                                            data: imageData,
                                            mimeType: image.mimeType || 'image/png',
                                            source: sourceName,
                                            prompt: task.prompt || 'æ— æç¤ºè¯',
                                            timestamp: task.createdAt || 0,
                                            fromHistory: true
                                        });
                                    }
                                }
                            });
                        }
                        // å¤„ç†è§†é¢‘ä»»åŠ¡ï¼ˆå¯çµç­‰ï¼‰
                        if (task.videoUrl && task.status === 'completed') {
                            const uniqueId = `history-${task.id}-video`;
                            if (!seenIds.has(uniqueId)) {
                                seenIds.add(uniqueId);
                                mediaItems.push({
                                    id: uniqueId,
                                    taskId: task.id,
                                    type: 'video',
                                    data: task.videoUrl,
                                    source: sourceName,
                                    prompt: task.prompt || 'æ— æç¤ºè¯',
                                    timestamp: task.createdAt || 0,
                                    fromHistory: true
                                });
                            }
                        }
                    });
                } catch (e) {
                    console.warn(`è¯»å– ${pageKey} å†å²å¤±è´¥:`, e);
                }
            }
            
            // æŒ‰æ—¶é—´å€’åº
            mediaItems.sort((a, b) => b.timestamp - a.timestamp);
            return mediaItems;
        };
        
        // æ›´æ–°ç»Ÿè®¡
        const updateStats = (items) => {
            const imageCount = items.filter(i => i.type === 'image').length;
            const videoCount = items.filter(i => i.type === 'video').length;
            
            // åªè®¡ç®—å½“å‰æ˜¾ç¤ºé¡¹çš„å¤§å°ï¼ˆé¿å…å¤§é‡æ•°æ®æ—¶å¡é¡¿ï¼‰
            let totalSize = 0;
            const sampleItems = items.slice(0, 50); // åªé‡‡æ ·å‰50ä¸ª
            sampleItems.forEach(item => {
                if (item.data && item.data.startsWith('data:')) {
                    // Base64 æ•°æ®ï¼Œä¼°ç®—å¤§å°
                    totalSize += (item.data.length * 0.75);
                }
            });
            // æŒ‰æ¯”ä¾‹ä¼°ç®—æ€»å¤§å°
            if (sampleItems.length > 0 && items.length > sampleItems.length) {
                totalSize = totalSize * (items.length / sampleItems.length);
            }
            const storageSize = (totalSize / (1024 * 1024)).toFixed(2);
            
            document.getElementById('imageCount').textContent = imageCount;
            document.getElementById('videoCount').textContent = videoCount;
            document.getElementById('storageSize').textContent = `~${storageSize}`;
        };
        
        // åˆ†é¡µé…ç½®
        const PAGE_SIZE = 50;
        let localCurrentPage = 1;
        let currentDisplayItems = [];
        
        // æ¸²æŸ“åª’ä½“é¡¹ï¼ˆå¸¦åˆ†é¡µï¼‰
        const renderMedia = (items) => {
            const resultsGrid = document.getElementById('resultsGrid');
            const resultsCount = document.getElementById('resultsCount');
            
            currentDisplayItems = items;
            
            if (items.length === 0) {
                resultsGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <h3>æš‚æ— ç¼“å­˜</h3>
                        <p>ä½¿ç”¨å„åŠŸèƒ½ç”Ÿæˆå›¾ç‰‡æˆ–è§†é¢‘åï¼Œä¼šè‡ªåŠ¨ä¿å­˜åˆ°è¿™é‡Œã€‚</p>
                    </div>
                `;
                resultsCount.textContent = 'å…± 0 é¡¹';
                renderPagination(0);
                return;
            }
            
            // è®¡ç®—åˆ†é¡µ
            const totalPages = Math.ceil(items.length / PAGE_SIZE);
            if (localCurrentPage > totalPages) localCurrentPage = totalPages;
            const startIdx = (localCurrentPage - 1) * PAGE_SIZE;
            const endIdx = Math.min(startIdx + PAGE_SIZE, items.length);
            const pageItems = items.slice(startIdx, endIdx);
            
            resultsCount.textContent = `å…± ${items.length} é¡¹ï¼Œæ˜¾ç¤º ${startIdx + 1}-${endIdx}`;
            
            resultsGrid.innerHTML = pageItems.map(item => {
                const isVideo = item.type === 'video';
                const isCloud = item.fromCloud;
                const mediaTag = isVideo 
                    ? `<video src="${item.data}" preload="metadata"></video>`
                    : `<img src="${item.data}" alt="ç¼“å­˜å›¾ç‰‡" loading="lazy" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2220%22>åŠ è½½å¤±è´¥</text></svg>'">`;
                
                const deleteBtn = isCloud 
                    ? `<button class="btn-delete" onclick="deleteCloudMedia('${item.generationId}')">åˆ é™¤</button>`
                    : `<button class="btn-delete" onclick="deleteMedia('${item.id}')">åˆ é™¤</button>`;
                
                const typeBadge = isCloud ? 'â˜ï¸ äº‘ç«¯' : (isVideo ? 'è§†é¢‘' : 'å›¾ç‰‡');
                
                return `
                    <div class="result-card" data-id="${item.id}" onclick="openPreview('${item.id}')">
                        <div class="result-preview">
                            ${mediaTag}
                            <span class="result-type-badge">${typeBadge}</span>
                        </div>
                        <div class="result-info">
                            <div class="result-title">${item.source}</div>
                            <div class="result-meta">
                                <span>${formatTime(item.timestamp)}</span>
                                <span style="font-size:11px;color:#94a3b8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${(item.prompt || '').substring(0, 30)}${(item.prompt || '').length > 30 ? '...' : ''}</span>
                            </div>
                            <div class="result-actions" onclick="event.stopPropagation()">
                                <button class="btn-download" onclick="downloadMedia('${item.id}')">ä¸‹è½½</button>
                                ${deleteBtn}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            renderPagination(items.length);
        };
        
        // æ¸²æŸ“åˆ†é¡µæ§ä»¶
        const renderPagination = (totalItems) => {
            let paginationEl = document.getElementById('paginationContainer');
            if (!paginationEl) {
                paginationEl = document.createElement('div');
                paginationEl.id = 'paginationContainer';
                paginationEl.style.cssText = 'display:flex;justify-content:center;gap:8px;margin-top:20px;flex-wrap:wrap;';
                document.getElementById('resultsGrid').parentNode.appendChild(paginationEl);
            }
            
            if (totalItems <= PAGE_SIZE) {
                paginationEl.innerHTML = '';
                return;
            }
            
            const totalPages = Math.ceil(totalItems / PAGE_SIZE);
            let html = '';
            
            // ä¸Šä¸€é¡µ
            html += `<button class="filter-btn" onclick="goToLocalPage(${localCurrentPage - 1})" ${localCurrentPage <= 1 ? 'disabled style="opacity:0.5;cursor:not-allowed;"' : ''}>â€¹ ä¸Šä¸€é¡µ</button>`;
            
            // é¡µç 
            const maxVisiblePages = 5;
            let startPage = Math.max(1, localCurrentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                html += `<button class="filter-btn" onclick="goToLocalPage(1)">1</button>`;
                if (startPage > 2) html += `<span style="padding:8px;color:#94a3b8;">...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="filter-btn ${i === localCurrentPage ? 'active' : ''}" onclick="goToLocalPage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span style="padding:8px;color:#94a3b8;">...</span>`;
                html += `<button class="filter-btn" onclick="goToLocalPage(${totalPages})">${totalPages}</button>`;
            }
            
            // ä¸‹ä¸€é¡µ
            html += `<button class="filter-btn" onclick="goToLocalPage(${localCurrentPage + 1})" ${localCurrentPage >= totalPages ? 'disabled style="opacity:0.5;cursor:not-allowed;"' : ''}>ä¸‹ä¸€é¡µ â€º</button>`;
            
            paginationEl.innerHTML = html;
        };
        
        // è·³è½¬åˆ°æŒ‡å®šé¡µ
        window.goToLocalPage = (page) => {
            const totalPages = Math.ceil(currentDisplayItems.length / PAGE_SIZE);
            if (page < 1 || page > totalPages) return;
            localCurrentPage = page;
            renderMedia(currentDisplayItems);
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            document.getElementById('resultsGrid').scrollIntoView({ behavior: 'smooth' });
        };
        
        // åŠ è½½æ‰€æœ‰åª’ä½“
        const loadAllMedia = async () => {
            try {
                allMediaItems = await extractAllMedia();
                // æŒ‰æ—¶é—´å€’åºæ’åˆ—
                allMediaItems.sort((a, b) => b.timestamp - a.timestamp);
                updateStats(allMediaItems);
                localCurrentPage = 1; // é‡ç½®é¡µç 
                filterMedia(currentFilter);
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                showToast('åŠ è½½å¤±è´¥');
            }
        };
        
        // è¿‡æ»¤åª’ä½“
        const filterMedia = async (type) => {
            currentFilter = type;
            
            if (type === 'cloud') {
                if (!isLoggedIn) {
                    showToast('è¯·å…ˆç™»å½•è´¦å·æ‰èƒ½æŸ¥çœ‹äº‘ç«¯æ•°æ®');
                    return;
                }
                // åŠ è½½äº‘ç«¯æ•°æ®
                showToast('æ­£åœ¨åŠ è½½äº‘ç«¯æ•°æ®...');
                cloudMediaItems = await loadCloudData(1);
                updateStats(cloudMediaItems);
                renderMedia(cloudMediaItems);
                return;
            }
            
            let filtered = allMediaItems;
            
            if (type === 'image') {
                filtered = allMediaItems.filter(i => i.type === 'image');
            } else if (type === 'video') {
                filtered = allMediaItems.filter(i => i.type === 'video');
            }
            
            updateStats(filtered);
            renderMedia(filtered);
        };
        
        // ä¸‹è½½å•ä¸ªåª’ä½“
        window.downloadMedia = (id) => {
            // å…ˆä»æœ¬åœ°æ‰¾ï¼Œå†ä»äº‘ç«¯æ‰¾
            let item = allMediaItems.find(i => i.id === id);
            if (!item) {
                item = cloudMediaItems.find(i => i.id === id);
            }
            if (!item) return;
            
            const link = document.createElement('a');
            link.href = item.data;
            const ext = item.type === 'video' ? 'mp4' : 'png';
            link.download = `${item.source}_${Date.now()}.${ext}`;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('ä¸‹è½½æˆåŠŸ');
        };
        
        // æ‰“å¼€é¢„è§ˆ
        window.openPreview = (id) => {
            // ç¡®å®šå½“å‰åˆ—è¡¨
            currentPreviewList = currentFilter === 'cloud' ? cloudMediaItems : 
                (currentFilter === 'image' ? allMediaItems.filter(i => i.type === 'image') :
                 currentFilter === 'video' ? allMediaItems.filter(i => i.type === 'video') : allMediaItems);
            
            currentPreviewIndex = currentPreviewList.findIndex(i => i.id === id);
            if (currentPreviewIndex === -1) return;
            
            showPreviewItem(currentPreviewIndex);
            document.getElementById('previewModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        };
        
        // æ˜¾ç¤ºé¢„è§ˆé¡¹
        const showPreviewItem = (index) => {
            const item = currentPreviewList[index];
            if (!item) return;
            
            const previewContent = document.getElementById('previewContent');
            const previewInfo = document.getElementById('previewInfo');
            
            if (item.type === 'video') {
                previewContent.innerHTML = `<video src="${item.data}" controls autoplay></video>`;
            } else {
                previewContent.innerHTML = `<img src="${item.data}" alt="é¢„è§ˆå›¾ç‰‡">`;
            }
            
            previewInfo.innerHTML = `
                <div class="source">${item.source}${item.fromCloud ? ' â˜ï¸' : ''}</div>
                <div class="prompt">${item.prompt || 'æ— æç¤ºè¯'}</div>
                <div class="time">${formatTime(item.timestamp)}</div>
            `;
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            document.getElementById('prevBtn').disabled = index <= 0;
            document.getElementById('nextBtn').disabled = index >= currentPreviewList.length - 1;
            
            // ç»‘å®šä¸‹è½½æŒ‰é’®
            document.getElementById('previewDownloadBtn').onclick = () => downloadMedia(item.id);
        };
        
        // å¯¼èˆªé¢„è§ˆ
        window.navigatePreview = (direction) => {
            const newIndex = currentPreviewIndex + direction;
            if (newIndex >= 0 && newIndex < currentPreviewList.length) {
                currentPreviewIndex = newIndex;
                showPreviewItem(currentPreviewIndex);
            }
        };
        
        // å…³é—­é¢„è§ˆ
        window.closePreview = () => {
            document.getElementById('previewModal').classList.remove('show');
            document.body.style.overflow = '';
            // åœæ­¢è§†é¢‘æ’­æ”¾
            const video = document.querySelector('#previewContent video');
            if (video) video.pause();
        };
        
        // é”®ç›˜å¯¼èˆª
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('previewModal');
            if (!modal.classList.contains('show')) return;
            
            if (e.key === 'Escape') closePreview();
            if (e.key === 'ArrowLeft') navigatePreview(-1);
            if (e.key === 'ArrowRight') navigatePreview(1);
        });
        
        // åˆ é™¤å•ä¸ªåª’ä½“
        window.deleteMedia = async (id) => {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')) return;
            
            try {
                const item = allMediaItems.find(i => i.id === id);
                if (!item) return;
                
                if (item.fromPersonal && item.dbId) {
                    // ä»ä¸ªäººç©ºé—´åˆ é™¤
                    await DuuDB.deletePersonal(item.dbId);
                } else if (item.fromHistory && item.taskId) {
                    // ä½¿ç”¨ä¿å­˜çš„ imageIndex åˆ é™¤å•å¼ å›¾ç‰‡
                    if (typeof item.imageIndex === 'number' && item.type === 'image') {
                        await DuuDB.deleteTaskImage(item.taskId, item.imageIndex);
                    } else {
                        // è§†é¢‘æˆ–æ— ç´¢å¼•ï¼Œåˆ é™¤æ•´ä¸ªä»»åŠ¡
                        await DuuDB.deleteTask(item.taskId);
                    }
                }
                
                showToast('åˆ é™¤æˆåŠŸ');
                await loadAllMedia();
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                showToast('åˆ é™¤å¤±è´¥');
            }
        };
        
        // å…¨éƒ¨ä¸‹è½½ - æ‰“åŒ…æˆ ZIP
        const downloadAll = async () => {
            const items = currentFilter === 'cloud' ? cloudMediaItems : 
                (currentFilter === 'image' ? allMediaItems.filter(i => i.type === 'image') :
                 currentFilter === 'video' ? allMediaItems.filter(i => i.type === 'video') : allMediaItems);
            
            if (items.length === 0) {
                showToast('æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦æ‰“åŒ…ä¸‹è½½ ${items.length} ä¸ªæ–‡ä»¶å—ï¼Ÿ`)) return;
            
            // æ£€æŸ¥ JSZip æ˜¯å¦åŠ è½½
            if (typeof JSZip === 'undefined') {
                showToast('æ­£åœ¨åŠ è½½æ‰“åŒ…ç»„ä»¶...');
                // é™çº§ä¸ºé€ä¸ªä¸‹è½½
                items.forEach((item, index) => {
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = item.data;
                        const ext = item.type === 'video' ? 'mp4' : 'png';
                        link.download = `${item.source}_${index + 1}.${ext}`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }, index * 200);
                });
                showToast(`å¼€å§‹ä¸‹è½½ ${items.length} ä¸ªæ–‡ä»¶`);
                return;
            }
            
            showToast('æ­£åœ¨æ‰“åŒ…ï¼Œè¯·ç¨å€™...');
            
            try {
                const zip = new JSZip();
                const folder = zip.folder('å°åŠ©æ‰‹å¯¼å‡º_' + new Date().toLocaleDateString('zh-CN').replace(/\//g, '-'));
                
                let completed = 0;
                const total = items.length;
                
                for (const item of items) {
                    try {
                        const ext = item.type === 'video' ? 'mp4' : 'png';
                        const fileName = `${item.source}_${completed + 1}.${ext}`;
                        
                        // å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®
                        if (item.data.startsWith('data:')) {
                            // Base64 æ•°æ®
                            const base64Data = item.data.split(',')[1];
                            folder.file(fileName, base64Data, { base64: true });
                        } else if (item.data.startsWith('http')) {
                            // URL - éœ€è¦ fetch
                            try {
                                const response = await fetch(item.data);
                                const blob = await response.blob();
                                folder.file(fileName, blob);
                            } catch (e) {
                                console.warn('ä¸‹è½½è¿œç¨‹æ–‡ä»¶å¤±è´¥:', item.data, e);
                            }
                        }
                        
                        completed++;
                        if (completed % 5 === 0) {
                            showToast(`æ‰“åŒ…ä¸­... ${completed}/${total}`);
                        }
                    } catch (e) {
                        console.warn('å¤„ç†æ–‡ä»¶å¤±è´¥:', e);
                    }
                }
                
                showToast('æ­£åœ¨ç”Ÿæˆ ZIP æ–‡ä»¶...');
                
                const content = await zip.generateAsync({ 
                    type: 'blob',
                    compression: 'DEFLATE',
                    compressionOptions: { level: 6 }
                });
                
                // ä¸‹è½½ ZIP
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `å°åŠ©æ‰‹å¯¼å‡º_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
                
                showToast(`æ‰“åŒ…å®Œæˆï¼å…± ${completed} ä¸ªæ–‡ä»¶`);
            } catch (error) {
                console.error('æ‰“åŒ…å¤±è´¥:', error);
                showToast('æ‰“åŒ…å¤±è´¥: ' + error.message);
            }
        };
        
        // å…¨éƒ¨åˆ é™¤
        const deleteAll = async () => {
            if (allMediaItems.length === 0) {
                showToast('æ²¡æœ‰å¯åˆ é™¤çš„æ–‡ä»¶');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤å…¨éƒ¨ ${allMediaItems.length} ä¸ªæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;
            
            try {
                await DuuDB.clearAll();
                showToast('å·²åˆ é™¤æ‰€æœ‰æ–‡ä»¶');
                await loadAllMedia();
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                showToast('åˆ é™¤å¤±è´¥');
            }
        };
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            // æ¸²æŸ“ç”¨æˆ·çŠ¶æ€
            renderUserStatus();
            
            // æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤º/éšè—äº‘ç«¯æŒ‰é’®
            if (cloudBtn) {
                if (isLoggedIn) {
                    cloudBtn.style.display = 'inline-block';
                } else {
                    cloudBtn.style.background = '#e2e8f0';
                    cloudBtn.style.color = '#94a3b8';
                    cloudBtn.title = 'ç™»å½•åå¯æŸ¥çœ‹äº‘ç«¯æ•°æ®';
                }
            }
            
            await loadAllMedia();
            
            document.getElementById('refreshBtn').addEventListener('click', async () => {
                if (currentFilter === 'cloud') {
                    cloudMediaItems = await loadCloudData(currentPage);
                    renderMedia(cloudMediaItems);
                } else {
                    await loadAllMedia();
                }
                showToast('å·²åˆ·æ–°');
            });
            
            document.getElementById('downloadAllBtn').addEventListener('click', downloadAll);
            document.getElementById('deleteAllBtn').addEventListener('click', deleteAll);
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const type = btn.getAttribute('data-type');
                    filterMedia(type);
                });
            });
        });
    </script>
</body>
</html>
